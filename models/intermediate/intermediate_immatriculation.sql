SELECT 
    CASE 
        WHEN CODGEO BETWEEN '75101' AND '75120' THEN '75056'  
        WHEN CODGEO BETWEEN '69381' AND '69389' THEN '69123'  
        WHEN CODGEO BETWEEN '13201' AND '13216' THEN '13055'  
        ELSE CODGEO
    END AS CODGEO,
    LIBGEO,
    COALESCE(EPCI, 'NON RENSEIGNE') AS EPCI,
    COALESCE(LIBEPCI, 'NON RENSEIGNE') AS LIBEPCI,
    DATE_ARRETE,
    COALESCE(NB_VP_RECHARGEABLES_EL, 0) AS NB_VP_RECHARGEABLES_EL,
    COALESCE(NB_VP, 0) AS NB_VP,
    ROUND(SAFE_DIVIDE(NB_VP_RECHARGEABLES_EL, NULLIF(NB_VP, 0)) * 100, 2) AS RATIO_VP_RECHARGEABLES_EL_PCT
FROM {{ ref("stg_Dataset_e_quilibre__immatriculations_data") }}
